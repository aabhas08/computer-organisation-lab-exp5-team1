<!-- This file needs to be edited by the lab developer to suit
the requirements of their lab in particular.-->

<!-- Add class="default" to include any element as it is
specified in default.html. 
Do not include class="default" to the elements that you want to
edit -->

<!DOCTYPE html>
<html>
<head></head>
<body>

<div id="experiment"> <!-- The Experiment Document Container-->

  <!-- The lab Header contains the logo and the name of the lab,
  usually displayed on the top of the page-->

  <header id="experiment-header" class="default">
  
    <div id="experiment-header-logo" class="logo">
      <!-- Enclose the logo image of your lab or write it in 
      text-->
      <img src="../images/logo.jpg" />
    </div>

    <div id="experiment-header-heading" class="heading">
      <!-- Write the name of your lab and link it to the home 
      page of your lab (h1 tag is preferred while writing your 
      lab name)-->
      <a href="../index.php">CSO Lab</a>	
    </div>

    <!-- Add any additional element you want to add to the lab 
    header, For example : Help (Enclosing them with suitable 
    div is recommended)-->

  </header>


  <!-- The lab article is the main content area where all the 
  experiment content sits-->
  <article id="experiment-article">
  
    <!-- The lab article has an header, optional navigational 
    menu, number of sections, an optional sidebar and a closing 
    footer-->
     <div id="experiment-article-breadcrumb" class="breadcrumb" style="margin-left:30em;">
     </div>
    
      <header id="experiment-article-heading" class="heading">
        <!-- You can add a welcome message or title of the 
        experiment here -->
        MIPS Assembly Language Programming
        <!-- Add any additional element if required with proper 
        enclosing-->
      </header>

      <!-- Navigation menu is useful to organize the view of 
      multiple sections inside the article-->
      <nav id="experiment-article-navigation" class="default">
        <ul id="experiment-article-navigation-menu">
          <!-- The menu can be dynamically generated to contain 
          the headings of your sections or instead write the 
          menu items of your choice individually enclosedu in 
          <li> tag as shown below-->
        </ul>
      </nav>

      <!-- All the sections of your lab or experiment can be 
      enclosed together with a div element as shown below-->
      <div id="experiment-article-sections">

        <!-- First section of the article-->
        <section id="experiment-article-section-1">
          
          <div id="experiment-article-section-1-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab -->
	    <img src="../images/introduction.jpg" />
	  </div>	
          
          <!-- The heading for the section can be enclosed in a 
          div tag. -->
          <div id="experiment-article-section-1-heading" 
          class="heading">
            Introduction
          </div>

          <!-- Write the section content inside a paragraph 
          element, You can also include images with <img> tag -->
          <div id="experiment-article-section-1-content" 
          class="content">	
   <p>A High Level Programming Language like C provides <strong>abstractions</strong> to program an underlying computing system. The following is a broad classification of various abstractions.</p>
	<ol>
	  <li>
	    <div align="justify"><strong>Data Abstractions:</strong> Data Abstractions provide certain primitive data types like int, float, char etc. and a mechanism (like structures, arrays etc.) to hierarchilaly compose the primitive data types to create new abstract data types.</div>
	  </li>
      <li>
        <div align="justify"><strong>Data Processing Abstractions:</strong> Data Processing Abstractions provide operations (like addition, multiplication, comparison etc.) which act on the primitive data types which can again be composed to act on user-defined data types.</div>
      </li>
      <li>
        <div align="justify"><strong>Control Abstractions:</strong> Control abstractions include language features like conditional/unconditional goto, if-then-else, for-loop, while-loop etc. A language which doesn't support at least one these Control Abstractions will not be Turing Complete which means there exists certain functions which are not computable using the language features alone.</div>
      </li>
      <li>
        <div align="justify"><strong>Procedural Abstraction: </strong>Procedures allows a user to define his/her own operation to act upon primitive or user defined data types. Further it allows modular development of programs enabling software readability, maintainability and efficiency also.</div>
      </li>
      <li>
        <div align="justify"><strong>More Abstractions: </strong>Object-oriented languages like C++ and Java provide features like classes, inheritance, polymorphism etc. Similary different langugages can provide different sets of abstraction depending upon their design philosophy and utility.</div>
      </li>
  </ol>
	<p align="justify">In this assignment and in the next few we shall learn how to implement these High Level Language Abstractions in the Assembly Language. There are 2 sets of assignments corresponding to MIPS and ARM Instruction Set Architectures (ISAs). Both MIPS and ARM ISA follow RISC philosophy.</p>
        </div>


      </section>

      <!-- Second section of the article-->
      <section id="experiment-article-section-2">
        
        <div id="experiment-article-section-2-icon" 
        class="icon">
	  <!-- Enclose the icon image of your lab. -->
	  <img src="../images/theory.jpg" />
	</div>
				
        <!-- The heading for the section can be enclosed in a 
        div tag. -->
        <div id="experiment-article-section-2-heading" 
        class="heading">
          Theory
        </div>


        <!-- Write the section content inside a paragraph 
        element, we can also include images with <img> tag -->
        <div id="experiment-article-section-2-content" 
        class="content">
	<p align="justify">There are several versions of the MIPS ISA and the one which we will be making use of in our assignments is a subset of MIPS32 Release 3. In particular our simulator supports only the MIPS CPU core instructions and these instructions are sufficient to do all the assignments. Please refer the document <em>MIPS Architecure For Programmers, Volume I-A: Introduction to the MIPS 32 Architecture </em>for more details.</p>
	<p align="justify"><img src="images/MIPSISAVersions.gif" width="854" height="665" /></p>
	<hr />
	<h3><strong>Structure of an Assembly Language Program</strong></h3>
  <p align="justify">Every assembly language program contains a Text Section (also called as Code Section) and an optional Data Section. In the Data Section we allocate memory to various program variables using Assembly Language Directives and in the Text Section we wrtie the assembly code which is a sequence of assembly language instructions to manipulate the data items declared in the Data Section. In High Level Programming Languages, a Compiler takes care of memory allocation to program variables by using the variable declarations like<span class="style1"> int a, b[10];</span>, whereas in assembly the programmer has to do it explic;itly with the assistance of the assembler. The following is a sample MIPS program evaluating the expression <em><font face="Times New Roman, Times, serif">varc = vara + varb</font> </em>where variables <font face="Times New Roman, Times, serif">var<em>a, varb</em></font> and<em> <font face="Times New Roman, Times, serif">varc</font></em> are integer.	  </p>
  
	<div align="justify">
<pre class="code"><span class=cmt>// Data Section</span>
<span class="keyw">.data</span>
vara: .word 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// initialize vara to 10</span>
varb: .word 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// initialize varb to 20</span>
varc: .word&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// No initial value specified for varc</span>
<span class=cmt>// Code Section</span>
<span class="keyw">.text</span>
lw $8, vara
lw $9, varb
add $10, $8, $9
sw varc, $10 
halt 
    	</pre>
          <h3>&nbsp; </h3>
          <h3>Writing if-then-else Code in MIPS</h3>
      <p>The following are the different kinds of Control-Abstractions provided by almost all high-level languages.</p>
          <ol>
            <li>goto statements.</li>
            <li>if-then-else statements</li>
            <li>Loop Constructs - do-while, for loops etc.</li>
          </ol>
          <p>All though any one of these Control Statements are sufficient to compute any function, a control statement in one form could be more appropriate in a particular situation than the others. For example, we could prefer a for-loop over a while-loop while iterating over array elements.</p>
          <p align="justify">MIPS ISA provides pc-relative conditional and unconditional branch instructions. Whereas the jump instructions use absolute addressing mode. Unlike other ISAs MIPS does not have a Condition Code register. So the MIPS ISA does not have CMP (compare) like instructions. MIPS ISA have branch delay slots and branch likely delay slots. The following is an example of how to convert an if-then-else construct into MIPS assembly. </p>
          <div align="justify">
            <pre class="code"><span class="cmt">// C-code
</span>if ( vara &gt;= varb ) {
	varc = vara - varb 
} 
else {
 varc = vara + varb
}<br />
<span class="cmt">// MIPS Code Fragment</span>
<span class="cmt">// Assume vara, varb, varc are signed integers residing in registers $r2, $r3 and $r4 respectively.</span>
<span class="keyw"></span>
     sub $1, $2, $3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Store the result vara-varb in $r1 register. 
     bgez if
     nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# branch delay slot
     add $4, $1, $2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# compute vara+varb and store the result in $r4 register
     b exit
if:  mov $4, $1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Computing if-part
exit:    	</pre>
            <h3 align="justify">&nbsp;</h3>
            <h3 align="justify">Implementing Loop Structures in MIPS ISA</h3>
            <p align="justify">Loops are an important form of control abstraction for programming. We have various kinds of loops like for, do-while, repeat-until etc. and each of these forms are suitable for a particular programming purpose. Any loop can be implemented using conditional and unconditional branch statements.</p>
            <p align="justify"></p>
            <p>The following is an example of a code segment illustrating how to translate loop structures into MIPS Assembly</p>
            <div align="justify">
              <pre class="code"><span class="cmt">// C-code</span>
sum = 0
for( i = 0; i &lt; 100; ++i ) 
   sum = sum + a[i];<span class="cmt">
// MIPS Assembly<br />// Data Section</span>
<span class="keyw">.data</span>
a .space 400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// allocate 400 bytes</span>
<span class="cmt">// Code Section</span>. Assume index variable i is in register $r1 and sum is in register $r2.
<span class="keyw">.text</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addi $1, $0, #100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// i = $r1 = 0</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor $2, $2, $2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">&nbsp;&nbsp;// sum = $r2 = 0</span>
loop:  la $3, a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// $r3 = &amp;a </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lw $4, ($3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// $r4 = a[i]</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add $2, $2, $4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// sum = sum + a[i]</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addi $3, $3, #4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// a = a + 4</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subi $1, $1, #1         <span class="cmt">// i = i - 1</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bgez $1, loop
       nop  
       halt 
    	    </pre>
            </div>
          </div>
          </div>
	</div>
      </section>


      <section id="experiment-article-section-3">
        
        <div id="experiment-article-section-3-icon" 
        class="icon">
	  <!-- Enclose the icon image of your lab. -->
	  <img src="../images/objective.jpg" />
	</div>
     
        <div id="experiment-article-section-3-heading" 
        class="heading">
          Objective
        </div>

        <div id="experiment-article-section-3-content" 
        class="content">
       <p>The following are the objectives of this series of assignments.</p>
	<ol>
	  <li>Introduce the Structure of an Assembly Language Program: Data and Text Sections.</li>
      <li>Introduce Assembly Directives to allocate memory in the Data Section.</li>
      <li>Introduce the idea that MIPS is a Load-Store Architecture and data has to be moved to registers before any operations can be performed on them.</li>
      <li>Difference between Signed and Unsigned Arithmetic.</li>
      <li>What if there are program constants whose size is greater than 16 bits?</li>
      <li>How to convert a complex expression into an Assembly Program evaluating that expression?</li>
      <li>How to translate if-then-else statements into Assembly?</li>
      <li>How to write loops in Assembly?</li>
  </ol>

        </div>

      </section>


      <section id="experiment-article-section-4">

        <div id="experiment-article-section-4-icon" 
        class="icon">
	  <!-- Enclose the icon image of your lab.-->
	  <img src="../images/simulation.jpg" />
	</div>

        <div id="experiment-article-section-4-heading" 
        class="heading">
          Experiment
        </div>

        <div id="experiment-article-section-4-content" 
        class="content">
           <p>
             You can run the simulator as an applet in the browser or as an application using the command 'java -jar MIPSSimulator.jar'. You can download the simular <a href="MIPSSimulator.jar">here</a>.
    <APPLET codebase="classes" code="mipsparser_new/Interface.class" width=1000 height=700> 
       </APPLET></p>
        </div>

      </section>

<!--      <section id="experiment-article-section-5">
   
        <div id="experiment-article-section-5-icon" 
        class="icon">
	  <!-- Enclose the icon image of your lab.-->
	  <img src="../images/manual.jpg" />
	</div>

        <div id="experiment-article-section-5-heading" 
        class="heading">
          Manual
        </div>

        <div id="experiment-article-section-5-content" 
        class="content">
         
	 <p><strong> 
	Assembly Directives</strong></p>
 	<p>The following are the Assembly Language Directives that are supported by the current version of the MaxSim. More directives would be supported later.</p>
 	<ul>
 	  <li>.text</li>
 	  <li>.data</li>
 	  <li>.word</li>
 	  <li>.space</li>
  </ul>
    <p><strong>Alignment Assumptions</strong></p>
  <p>Data is automatically aligned on to the word boundaries</p>
  <p><strong>Instructions</strong></p>
 	<p>The simulator supports MIPS32 CPU Core Instruction Set.</p>
 	<p><strong>Branch Delay Slot</strong></p>
 	<p>Branch Delay Slot is not supported</p>
          </div>

        </section>
-->
        <section id="experiment-article-section-6">
      
          <div id="experiment-article-section-6-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab.-->
	    <img src="../images/quizzes.jpg" />
	  </div>

          <div id="experiment-article-section-6-heading" 
          class="heading">
            Quizzes
          </div>

          <div id="experiment-article-section-6-content" 
          class="content">
            
            <p><b>Q1. </b>In MIPS we can increment the contents of a memory location in a single instruction. <br> 
	  <input type="radio" name="q1" id="q1" value="1"> 
	  <font color="green"> True </font> <br> 
	  <input type="radio" name="q1" id="q1" value="0">
	  <font color="red"> False </font> <br/>
	  <br/> 
	  <b>Q2.</b> The maximum size of an immediate constant in add instruction is 0xFFFFFF.<br> 
	  <input type="radio" name="q2" id="q2" value="1"> 
	  <font color="green"> True </font> <br> 
	  <input type="radio" name="q2" id="q2"value="0">
	  <font color="red"> False </font> <br/>
	  <br/> 
	  <b>Q3.</b> Register $r0 always contains a zero value.<br> 
	  <input type="radio" name="q3" id="q3" value="1"> 
	  <font color="green"> True </font> <br> 
	  <input type="radio" name="q3" id="q3"value="0">
	  <font color="red"> False </font> <br/>
	  <br/> 
	  <b>Q4. </b>ADDIU can generate a  overflow trap.<br> 
	  <input type="radio" name="q4" id="q4" value="1"> 
	  <font color="green"> True </font> <br> 
	  <input type="radio" name="q4" id="q4" value="0">
	  <font color="red"> False </font> <br/>
	  <br/> 
	  <b>Q5.</b> We can use LB instruction to load a signed byte into a register and cast the signed byte to a signed word.<br> 
	  <input type="radio" name="q5" id="q5" value="1"> 
	  <font color="green"> True </font> <br> 
	  <input type="radio" name="q5" id="q5"value="0">
	  <font color="red"> False </font> <br/>
	  <br/> 
	  <input type="submit" value="Submit Answers" class="button" />
	</p>

          </div>

        </section>

        <section id="experiment-article-section-7">
	  
          <div id="experiment-article-section-7-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab. -->
	    <img src="../images/procedure.jpg" />
	  </div>
	
          <div id="experiment-article-section-7-heading" 
          class="heading">
	    Procedure
	  </div>
	
          <div id="experiment-article-section-7-content" 
          class="content">
	    <h2>Assignments</h2>
	<p>Write MIPS Assembly Language Programs computing the following expressions or program segments.</p>
	<ol>
	  <li>Variables are of type unsigned integers and word sized. Also the variables b, c, d and e are initialized to values 10, 20, 30 and 40 respectively.    
       <blockquote>
	      <p class="code"> a = (b + c) - (d + e)<br>
	      </p>
        </blockquote>  </li>
      <li>Variables are of type signed integers and half-word sized.<q> </q>Variables b, c, d and e are initialized to values -10, 20, 30 and -40 respectively.
        <blockquote>
            <p class="code"> a = (b + c) - (d + e)</p>
        </blockquote>
      </li>
      <li>Variables are of type unsigned integers and word sized. Also the variables b, c, d and e are initialized to values 10, 20, 30 and 40 respectively.
	    <blockquote>
	      <p class="code"> b = a + 256 . <br>
	      c = b - 0xfffff<br />
	      a = (b + c) - (d + e + 0xffffe)</p>
        </blockquote>
      </li>
      <li>Dot Product of two signed half-word sized integer array vectors A and B each of dimension 5. The resultant dot-product value should reside in the register $r1 by the end of computation.<br />
      </li>
      <li>A and B are two unsigned word-sized integer array vectors each of size dimension 5. Compute the following expression.

        <blockquote>
          <p class="code"> CONV = A[0] * B[4] + A[1] * B[3] + A[2] * B[2] + A[3] * B[1] + A[4] * B[0] </p>
        </blockquote>
      </li>
  </ol>
    <p>&nbsp;</p>
    <p>Write MIPS Assembly Language Programs equivalent to the following C-code fragements.    </p>
    <ol>
      <li>
        <p class="code">if ( a &lt; b) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// a and b are signed integers</span><br />
  &nbsp;&nbsp;&nbsp;c = a - b;<br />
          }<br />
        </p>
      </li>
      <li>
        <p class="code">if ( a &lt; b) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// a and b are unsigned integers</span><br />
          &nbsp;&nbsp;&nbsp;c = a - b;<br />
          }<br />
        </p>
      </li>
      <li>
        <p class="code">if ( a &lt; -1234) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// a is a signed integer</span><br />
          &nbsp;&nbsp;&nbsp;a  = 4 * a ;<br />
          }<br />
          else {<br />
          &nbsp;&nbsp;&nbsp;a = a/4;<br />
          }<br />
        </p>
      </li>
      <li>
        <p class="code">if ( a &lt; b ) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// a, b, c are unsigned integer</span><br />
          &nbsp;&nbsp;&nbsp;if ( a &lt; c) { <br />
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min = a;<br />
          &nbsp;&nbsp;&nbsp;}<br />
          &nbsp;&nbsp;&nbsp;else { min = b &lt; c ? b : c; }<br />
          }<br />
          else {<br />
          &nbsp;&nbsp;&nbsp;min = b &lt; c ? b : c<br />
          }</p>
      </li>
    </ol>
  <p>.</p>
  <p>Write MIPS Assembly Language Programs equivalent to the following C-code fragments..</p>
  <ol>
    <li>
      <blockquote>
        <p class="code"> sqrsum = 0; <br />
          for( i = 0 ; i &lt; 100; ++i) <br />
          &nbsp;&nbsp;&nbsp;&nbsp;sqrsum = sqrsum + a[i] * a[i];<br />
        </p>
      </blockquote>
    </li>
    <li>
      <blockquote>
        <p class="code">convsum = 0;<br />
          for ( i = 0, j = 99; i &lt;100; ++i, --j )<br />
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convsum += a[i] * b[j] ; <br />
        </p>
      </blockquote>
    </li>
    <li>
      <blockquote>
        <p class="code">sum = 0; <br />
          for( i = 0 ; i &lt; 100; ++i)<br />
          &nbsp;&nbsp;&nbsp;&nbsp;for( j = 0; j &lt; 100; ++j)<br />
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum = sum + a[i, j] ;</p>
      </blockquote>
    </li>
  </ol>
	  </div>
	
        </section>
			
		
        <section id="experiment-article-section-8">
   
          <div id="experiment-article-section-8-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab.-->
	    <img src="../images/readings.jpg" />
	  </div>

          <div id="experiment-article-section-8-heading" 
          class="heading">
            References
          </div>

          <div id="experiment-article-section-8-content" 
          class="content">
            <ol>
	  <li>MIPS Architecture For Programmers, Volume I-A: Introduction to the MIPS32 Architecture.</li>
      <li>MIPS Architecture For Programmers, Volume II-A: The MIPS32 Instruction Set</li>
      <li> Patterson, D. A. and Hennessy, J. L. &nbsp;Computer Organization and Design: the Hardware/Software Interface. 3rd Edition.</li>
  </ol>
          </div>

        </section>
<section id="lab-article-section-9">
	
		<div id="lab-article-section-9-icon" class="icon">
		<img src="../images/manual.jpg"/>
		</div>

		<div id="lab-article-section-9-heading" class="heading">
		Feedback
		</div>

		<div id="lab-article-section-9-content" class="content">
		<p>
			<ul>
			<li><a href="http://virtual-labs.ac.in/feedback/?lab=cse11" >Feedback</a></li>
			</ul>
		</p>
		</div>
     	</section>
      </div>


    <!-- An article can have a sidebar that contain related 
    links and additional material (however it is kept optional 
    at this moment) -->
    <aside id="lab-article-sidebar" class="default">
      <!-- put the content that you want to appear in the 
      sidebar -->	
    </aside>


    <!-- Article footer can display related content and 
    additional links -->						
    <footer id="lab-article-footer" class="default">
      <!-- Put the content that you want to appear here -->
    </footer>

  </article>


  <!-- Links to other labs, about us page can be kept the lab 
  footer-->
  <footer id="lab-footer" class="default">
    <!-- Put the content here-->
  </footer>

</div>		

</body>
</html>
